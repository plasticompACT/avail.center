<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>avail.center – Scenario Comparison</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    :root {
      --bg: #0a0a0a;
      --surface: #1a1a1a;
      --ink: #f5f5f5;
      --muted: #9ca3af;
      --border: #2d2d2d;
      --red: #de0707;
      --red-hover: #ff2a2a;
      --shadow: 0 6px 28px rgba(0,0,0,0.6);
      --header-h: 68px;
      --chart-h-mob: 50vh;
      --right-col-w: 42vw;
      --right-col-min: 520px;
      --radius: 20px;
    }
    html, body { background: var(--bg); color: var(--ink); }
    .headline { font-family: 'Space Grotesk', sans-serif; font-weight: 600; letter-spacing: -0.01em; }
    .ui { font-family: 'Inter', sans-serif; }
    .card { background: var(--surface); border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--border); }
    .touch-target { min-height: 44px; }
    .btn { @apply touch-target px-3 py-2 rounded-xl border transition; border: 1px solid var(--red); color: var(--red); background: white; }
    .btn:hover { background: #ffe5e5; }
    .btn-primary { background: var(--red); color: white; border: none; }
    .btn-primary:hover { background: var(--red-hover); }
    .slider::-webkit-slider-thumb { height: 28px; width: 28px; border-radius: 9999px; background: var(--red); border: 3px solid white; }
    .slider::-moz-range-thumb { height: 28px; width: 28px; border-radius: 9999px; background: var(--red); border: 3px solid white; }
    header.app-header {
      position: fixed; top:0; left:0; right:0; height: var(--header-h);
      background: rgba(255,255,255,0.85); backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border); z-index:100;
    }
    .app-title { color: var(--ink); }
    .dot { width: 10px; height: 10px; border-radius: 50%; background: var(--red); display: inline-block; }
    .dot-wrap { display: inline-flex; align-items: center; justify-content:center; }
    .dot-wrap:hover .dot { transform: scale(0.92); opacity: .85; }
    .chart-bar-mob {
      position: fixed; top: var(--header-h); left:0; right:0; height: var(--chart-h-mob);
      z-index:80; background: var(--bg); display:grid; place-items:center;
    }
    .chart-inner-mob canvas { width:100% !important; height:100% !important; }
    .top-spacer-mob { height: calc(var(--header-h) + var(--chart-h-mob)); }
    .subtle-note { color: var(--muted); font-size: 0.92rem; }
    .editable { outline: none; border-bottom: 1px dashed var(--red); transition: border-color .2s ease; }
    .editable:focus { border-bottom-color: var(--red-hover); }
    .panel { border: 1px solid var(--border); border-radius: var(--radius); background: #fff; box-shadow: var(--shadow); }
    @media (min-width: 1024px) {
      body.split { overflow-x: hidden; }
      .left-col { max-width: 960px; margin-left:auto; margin-right: calc(var(--right-col-w)); padding-right:28px; }
      .right-fixed { position: fixed; top: var(--header-h); right:0; width: max(var(--right-col-w), var(--right-col-min)); height: calc(100vh - var(--header-h)); display:flex; flex-direction: column; align-items:center; justify-content:flex-start; gap:12px; background: transparent; z-index: 90; padding: 12px 0; }
      .right-fixed canvas { width: 92% !important; height: 76vh !important; }
      .chart-bar-mob, .top-spacer-mob { display:none !important; }
    }
  
  /* Improved typography for dark mode */
  body, .ui {
    color: var(--ink);
    font-family: 'Inter', sans-serif;
    line-height: 1.65;
    font-weight: 400;
  }
  .headline {
    color: #ffffff;
    text-shadow: 0 0 10px rgba(255,255,255,0.1);
    font-weight: 600;
  }
  p, label, select, input, button, span {
    color: #e5e5e5 !important;
  }
  .subtle-note, .text-black\/80, .text-slate-600, .text-slate-700 {
    color: #bcbcbc !important;
  }
  .card, .panel {
    background: var(--surface);
    border: 1px solid var(--border);
    box-shadow: var(--shadow);
  }
  input, select, button {
    background-color: #111 !important;
    border-color: #333 !important;
  }
  .slider::-webkit-slider-thumb,
  .slider::-moz-range-thumb {
    border: 3px solid #222 !important;
  }
  footer {
    color: #888 !important;
  }
  
  /* Chart panels reverted to light mode for clarity */
  .chart-bar-mob .panel,
  .right-fixed .panel {
    background: #f7f8fa !important;
    border: 1px solid #e5e7eb !important;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08) !important;
  }
  .chart-bar-mob canvas,
  .right-fixed canvas {
    background: #ffffff !important;
  }
  #overlay-mob, #overlay-desk {
    background: rgba(255,255,255,0.6) !important;
    color: var(--red) !important;
    font-weight: 600 !important;
    text-align: center !important;
    display: grid !important;
    place-items: center !important;
  }
  
  /* Universal rounded design for buttons, cards, inputs, and panels */
  button, .btn, .card, .panel, input, select, textarea {
    border-radius: 16px !important;
  }
  .btn {
    border-radius: 16px !important;
  }
  .card, .panel {
    border-radius: 20px !important;
  }
  input[type="range"]::-webkit-slider-thumb,
  input[type="range"]::-moz-range-thumb {
    border-radius: 9999px !important;
  }
  
/* --- Compact modern layout (NYC–SF style) --- */
:root {
  --radius-sm: 12px;
  --radius-md: 16px;
  --radius-lg: 18px;
  --font-small: 0.85rem;
  --font-base: 0.95rem;
  --font-large: 1.15rem;
  --gap-tight: 0.5rem;
}

/* Global typography */
body, .ui {
  font-size: var(--font-base);
  line-height: 1.45;
  letter-spacing: -0.01em;
}

h1, .headline {
  font-size: var(--font-large) !important;
  font-weight: 600 !important;
  letter-spacing: -0.015em;
  text-transform: none;
}

p, label, span {
  font-size: var(--font-small) !important;
  color: #d4d4d4 !important;
}

/* Compact cards */
.card.criteria-card {
  padding: 0.65rem 1rem !important;
  border-radius: var(--radius-md) !important;
  font-size: var(--font-small);
  line-height: 1.4;
}

.criteria-card .headline {
  font-size: 1rem !important;
  font-weight: 600;
  margin-bottom: 0.25rem !important;
}

.criteria-card p {
  font-size: 0.8rem !important;
  opacity: 0.8;
  margin-bottom: 0.6rem !important;
}

/* Compact input styling */
.criteria-card input[type="range"] {
  height: 16px !important;
}
.criteria-card label {
  font-size: 0.8rem !important;
  color: #ccc !important;
}

/* Tight grid */
.criteria-card .grid {
  gap: 0.5rem !important;
}

/* Compact header and footer */
header.app-header {
  height: 60px !important;
  padding: 0 1.2rem !important;
}
footer {
  font-size: 0.8rem !important;
  margin-top: 4rem !important;
}

/* Buttons smaller but crisp */
.btn {
  padding: 0.35rem 0.75rem !important;
  font-size: 0.85rem !important;
  border-radius: var(--radius-sm) !important;
}


#btnPng { display: none !important; }
</style>



<style>
  header.app-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 68px;
    background: #de0707;
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    z-index: 100;
  }
  header.app-header h1 {
    font-family: 'Space Grotesk', sans-serif;
    font-weight: 600;
    font-size: 1.8rem;
    display: flex;
    align-items: center;
    gap: 0.6rem;
    color: white;
    margin: 0;
  }
  .dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: white;
    display: inline-block;
  }
  .dot-wrap:hover .dot {
    animation: pulse 1s ease-in-out infinite;
  }
  @keyframes pulse {
    0%,100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(0.9); opacity: 0.7; }
  }

  /* Improved typography for dark mode */
  body, .ui {
    color: var(--ink);
    font-family: 'Inter', sans-serif;
    line-height: 1.65;
    font-weight: 400;
  }
  .headline {
    color: #ffffff;
    text-shadow: 0 0 10px rgba(255,255,255,0.1);
    font-weight: 600;
  }
  p, label, select, input, button, span {
    color: #e5e5e5 !important;
  }
  .subtle-note, .text-black\/80, .text-slate-600, .text-slate-700 {
    color: #bcbcbc !important;
  }
  .card, .panel {
    background: var(--surface);
    border: 1px solid var(--border);
    box-shadow: var(--shadow);
  }
  input, select, button {
    background-color: #111 !important;
    border-color: #333 !important;
  }
  .slider::-webkit-slider-thumb,
  .slider::-moz-range-thumb {
    border: 3px solid #222 !important;
  }
  footer {
    color: #888 !important;
  }
  
  /* Chart panels reverted to light mode for clarity */
  .chart-bar-mob .panel,
  .right-fixed .panel {
    background: #f7f8fa !important;
    border: 1px solid #e5e7eb !important;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08) !important;
  }
  .chart-bar-mob canvas,
  .right-fixed canvas {
    background: #ffffff !important;
  }
  #overlay-mob, #overlay-desk {
    background: rgba(255,255,255,0.6) !important;
    color: var(--red) !important;
    font-weight: 600 !important;
    text-align: center !important;
    display: grid !important;
    place-items: center !important;
  }
  
  /* Universal rounded design for buttons, cards, inputs, and panels */
  button, .btn, .card, .panel, input, select, textarea {
    border-radius: 16px !important;
  }
  .btn {
    border-radius: 16px !important;
  }
  .card, .panel {
    border-radius: 20px !important;
  }
  input[type="range"]::-webkit-slider-thumb,
  input[type="range"]::-moz-range-thumb {
    border-radius: 9999px !important;
  }
  </style>




  <script>
    // Company license guard (filled by Netlify function)
    const LICENSE_CODE = "__LICENSE_CODE__";
    const LICENSE_EXPIRES = "__LICENSE_EXPIRES__"; // YYYY-MM-DD

    function isCompanyLicenseValid() {
      try {
        const name = (window.location.pathname.split("/").pop() || "");
        const m = name.match(/CODE-(\d{8})/);
        if (!m) return false;
        const fileCode = m[1];
        if (fileCode !== LICENSE_CODE) return false;

        const today = new Date();
        const exp = new Date(LICENSE_EXPIRES + "T23:59:59");
        return today <= exp;
      } catch (e) {
        return false;
      }
    }

    window.COMPANY_LICENSE_VALID = isCompanyLicenseValid();
  </script>

</head>

<body class="ui min-h-screen split">
  <header class="app-header">
    <div class="max-w-6xl mx-auto h-full px-4 sm:px-6 flex items-center justify-between">
      <h1 class="headline app-title text-2xl sm:text-3xl flex items-center gap-3 text-white">
        <span class="dot-wrap"><span class="dot"></span></span>
        avail.center
      </h1>
      
    </div>
  </header>

  <!-- Mobile chart -->
  <div class="chart-bar-mob">
    <div class="chart-inner-mob relative w-full h-full panel">
      <canvas id="radar-mobile"></canvas>
      <div id="overlay-mob" class="absolute inset-0 bg-white/60 backdrop-blur-sm hidden place-items-center text-slate-500 text-lg font-medium">
        Displaying your chart here in a moment
      </div>
    </div>
  </div>
  <div class="top-spacer-mob"></div>

  <!-- Desktop right chart + export -->
  <aside class="right-fixed">
    <div class="flex items-center gap-2">
      
      <button id="btnPng" class="btn">Export PNG</button>
      <button id="btnPdf" class="btn btn-primary">Export PDF</button>
    </div>
    <div class="relative w-full h-full flex items-center justify-center panel">
      <canvas id="radar-desktop"></canvas>
      <div id="overlay-desk" class="absolute inset-0 bg-white/60 backdrop-blur-sm hidden place-items-center text-slate-500 text-lg font-medium">
        Displaying your chart here in a moment
      </div>
    </div>
  </aside>

  <main class="left-col p-5 sm:p-8">
    <section class="mb-8">
      <div class="card p-6 sm:p-8">
        <h2 class="headline text-2xl sm:text-3xl mb-3">Focused, scenario-based evaluation</h2>
        <p class="text-[15px] sm:text-base text-black/80 mb-5">Pick a topic, set your criteria, rate your options. We will give you a radar chart with the full circle being the best option. Make it round.</p>

        <div class="grid gap-6 md:grid-cols-2">
          <div>
            <div id="categoryHint" class="subtle-note mb-2">My avail is about …</div>
            <select id="domainSelect" class="border rounded-xl p-2 bg-white w-full max-w-md">
              <option value="">– choose –</option>
            </select>
            <div class="mt-3" id="typeRadios"></div>
          </div>
          <div>
            <div class="flex items-center justify-between mb-1">
              <label class="block text-black font-medium">Options</label>
              <div class="flex gap-2">
                <button id="addOption" class="btn">➕ Add</button>
                <button id="removeOption" class="btn">➖ Remove</button>
              </div>
            </div>
            <div class="flex flex-col gap-2 max-w-md" id="optionNames"></div>
          </div>
        </div>
      </div>
    </section>

    <section class="mb-3">
      <div class="flex items-center justify-between">
        <h3 class="headline text-xl">Criteria</h3>
        <div class="flex gap-2">
          <button id="addQuestion" class="btn">➕ Add Question</button>
          <button id="removeQuestion" class="btn">➖ Remove Last</button>
        </div>
      </div>
    </section>

    <section id="questions" class="space-y-6"></section>

    <footer class="mt-12 mb-10 text-center text-sm text-black/60">
      <p>avail.center • No storage on server • Local only • © 2025</p>
    </footer>
  </main>

  
  <!-- Paywall modal -->
  <div id="paywallModal"
       class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-[200]">
    <div class="card p-6 w-[320px] text-center">
      <h2 class="headline text-xl mb-3">Export your file</h2>
      <p class="mb-4 text-sm opacity-80">
        Export your file.<br>
        One-time payment required.<br>
        No subscription.<br><br>
        We accept <b>plasticos</b><br>(insert 8-digit code)
      </p>

      <input id="plasticoInput"
             maxlength="8"
             class="border p-2 rounded w-full text-center bg-white text-black"
             placeholder="12345678">

      <p id="plasticoError"
         class="text-red-400 text-xs mt-2 hidden">
         Invalid code. Please try again.
      </p>

      <div class="flex gap-3 mt-5">
        <button id="plasticoCancel"
                class="btn w-1/2">Cancel</button>

        <button id="plasticoVerify"
                class="btn btn-primary w-1/2">
                Verify &amp; Export
        </button>
      </div>
<div class="mt-4">
  <button id="paypalBtn"
          class="w-full py-2 rounded-xl"
          style="
            background:#ffc439;
            color:#111;
            font-weight:600;
            border:none;
            box-shadow:0 2px 4px rgba(0,0,0,0.2);
          ">
    Pay with PayPal
  </button>
</div>
<div class="mt-3">
  <button id="stripeBtn"
          class="w-full py-2 rounded-xl"
          style="
            background:#635bff;
            color:white;
            font-weight:600;
            border:none;
            box-shadow:0 2px 4px rgba(0,0,0,0.2);
          ">
    Pay with Stripe
  </button>
</div>


    </div>
  </div>

  <script>
localStorage.clear();
/* === AUTO CLEAR ON LOAD === */
localStorage.clear();
// ===== Extended Model (8 domains × Type A/B with 20 criteria)
const BASE_MODEL = [
  // --- Organizational Domains ---
  { domain: "People & Talent", types: {
    A: { name: "HR Hiring Decisions", items: [
      "Educational background","Relevant work experience","Technical skills","Soft skills (communication, teamwork)","Problem-solving ability","Motivation and engagement","Cultural fit","Leadership potential","Adaptability and learning agility","Integrity and professionalism","References and past performance","Presentation and interview quality","Creativity and innovation potential","Attention to detail","Initiative and proactivity","Availability and timing","Salary expectations vs. budget","Location or mobility readiness","Long-term potential for growth","Overall suitability for the role"
    ]},
    B: { name: "Employee Performance Review", items: [
      "Goal achievement rate","Work quality and accuracy","Productivity and efficiency","Initiative and innovation","Collaboration and teamwork","Communication effectiveness","Leadership and mentoring","Reliability and consistency","Customer or stakeholder feedback","Problem-solving under pressure","Adaptability to change","Professional development effort","Ethical behavior and integrity","Contribution to company culture","Time management","Attendance and punctuality","Project delivery success","Peer and manager feedback","KPI or metric attainment","Overall performance rating"
    ]}
  }},
  { domain: "Organizational & Strategic", types: {
    A: { name: "Project or Strategy Evaluation", items: [
      "Strategic alignment","Market potential","Financial feasibility","Risk level","Time to impact","Stakeholder support","Technological feasibility","Legal or regulatory compliance","Resource availability","Competitive advantage","Scalability potential","Innovation value","Environmental or social impact","Communication clarity","Implementation readiness","Operational efficiency","Measurability of outcomes","Cost-benefit ratio","Long-term sustainability","Overall strategic value"
    ]},
    B: { name: "Supplier or Partner Selection", items: [
      "Technical compliance","Product or service quality","Delivery reliability","Financial stability","Industry reputation","References and past projects","Customer service responsiveness","Scalability and flexibility","Innovation capacity","Compliance with regulations","Ethical and ESG standards","Risk exposure","Warranty and support","Contractual clarity","Communication transparency","Cultural and operational fit","Geographic reach","Price competitiveness","Total cost of ownership","Overall supplier rating"
    ]}
  }},
  { domain: "Financial & Investment", types: {
    A: { name: "Investment Evaluation", items: [
      "Return on investment (ROI)","Net present value (NPV)","Internal rate of return (IRR)","Payback period","Market growth potential","Competitive landscape","Risk profile and volatility","Financial structure and leverage","Management team quality","Business model sustainability","Legal and regulatory exposure","Exit strategy options","Liquidity and cash flow stability","Economic environment sensitivity","ESG and ethical compliance","Technological disruption risk","Operational efficiency","Diversification benefits","Stakeholder alignment","Overall investment attractiveness"
    ]},
    B: { name: "Budget or Funding Allocation", items: [
      "Alignment with strategic goals","Expected ROI or impact","Resource availability","Cost realism and accuracy","Financial transparency","Past performance of budget holder","Risk of overspend","Opportunity cost","Urgency of need","Compliance with funding rules","Accountability mechanisms","Efficiency of use","Long-term sustainability","Social or environmental benefit","Innovation potential","Equity across units or projects","Implementation readiness","Monitoring and reporting plan","Flexibility for adjustment","Overall funding justification"
    ]}
  }},
  { domain: "Innovation & Creativity", types: {
    A: { name: "Idea Evaluation & Feasibility", items: [
      "Originality","Relevance to goals","Problem definition clarity","Solution novelty","Market potential","Feasibility of execution","Resource requirements","Scalability","Time to prototype","Collaboration opportunity","Risk level","Expected impact","Environmental sustainability","Cross-disciplinary value","User experience potential","Ethical considerations","Technical viability","Measurable success criteria","Presentation clarity","Overall innovation strength"
    ]},
    B: { name: "Creative Team Performance", items: [
      "Idea generation frequency","Collaboration quality","Diversity of thinking","Experimentation rate","Feedback culture","Risk-taking comfort","Time allocation for innovation","Leadership support","Cross-functional input","Recognition of creativity","Access to tools and resources","Alignment to strategy","Iteration speed","Learning from failure","Communication of ideas","Team cohesion","Project follow-through","Output quality","Knowledge sharing","Overall creative impact"
    ]}
  }},
  { domain: "Environment & Sustainability", types: {
    A: { name: "Corporate Sustainability Assessment", items: [
      "Carbon footprint","Energy efficiency","Waste management","Water use efficiency","Supplier sustainability","Product lifecycle impact","Recycling rates","Packaging reduction","ESG policy strength","Employee awareness","Transportation impact","Office energy initiatives","Sustainable procurement","Offsetting programs","Renewable energy share","Regulatory compliance","Transparency in reporting","Community engagement","Innovation in green practices","Overall sustainability score"
    ]},
    B: { name: "Environmental Project Evaluation", items: [
      "Ecological impact","Feasibility of implementation","Long-term benefits","Community involvement","Cost efficiency","Risk management","Stakeholder support","Data accuracy and baseline","Legal compliance","Innovation potential","Scalability","Monitoring plan","Funding sustainability","Education and outreach","Biodiversity impact","Resource efficiency","Social equity considerations","Partnership quality","Communication effectiveness","Overall environmental value"
    ]}
  }},

  // --- Personal Domains ---
  { domain: "Health & Wellbeing", types: {
    A: { name: "Personal Health Goals & Lifestyle Choices", items: [
      "Physical activity consistency","Nutrition balance","Sleep quality","Stress management","Work-life balance","Mental health awareness","Social connections","Emotional resilience","Rest and recovery habits","Hydration and diet variety","Preventive checkups","Self-discipline in habits","Substance moderation","Adaptability to change","Goal clarity and tracking","Mindfulness practice","Hobbies and joyful activities","Time outdoors / nature","Family and support system","Overall wellbeing score"
    ]},
    B: { name: "Workplace Wellness Programs", items: [
      "Program participation rate","Diversity of offerings","Psychological safety","Ergonomic support","Flexibility policies","Burnout prevention","Leadership role-modeling","Inclusivity of activities","Budget allocation","Communication and awareness","Measurable impact on health","Accessibility for all employees","Manager support training","Feedback loop quality","Vendor partnerships","Incentive alignment","Data privacy in wellness metrics","Continuous improvement plans","Integration with HR systems","Overall program effectiveness"
    ]}
  }},
  { domain: "Learning & Development", types: {
    A: { name: "Individual Skill Growth", items: [
      "Relevance to career goals","Time investment required","Learning method fit (style)","Mentor availability","Feedback mechanisms","Knowledge retention","Practical application","Skill transferability","Confidence gain","Peer learning opportunities","Alignment with current projects","Access to resources","Consistency of practice","Certification value","Cost vs benefit","Adaptability of curriculum","Motivation to continue","Recognition for progress","Measured outcomes","Overall learning impact"
    ]},
    B: { name: "Organizational Training Programs", items: [
      "Alignment with strategic needs","Participation rate","Trainer quality","Content relevance","Platform usability","Completion rates","Cost effectiveness","Post-training application","Manager involvement","Employee feedback","Accessibility and inclusivity","Frequency and cadence","Integration with HR systems","Learning analytics usage","Follow-up mechanisms","ROI measurement","Knowledge sharing culture","Innovation stimulus","Scalability across departments","Long-term capability building"
    ]}
  }},
  { domain: "Community & Social Impact", types: {
    A: { name: "CSR Project Evaluation", items: [
      "Alignment with mission","Beneficiary reach","Measurable outcomes","Stakeholder involvement","Resource allocation","Long-term sustainability","Social equity focus","Inclusivity","Transparency","Volunteer engagement","Impact tracking","Media visibility","Innovation in approach","Cost efficiency","Partnership strength","Local community feedback","Ethical standards","Risk assessment","Knowledge transfer","Overall social value"
    ]},
    B: { name: "Non-profit Program Performance", items: [
      "Clarity of objectives","Funding efficiency","Volunteer retention","Program reach","Community partnerships","Beneficiary feedback","Outcome measurement","Innovation capacity","Transparency in reporting","Staff competence","Donor satisfaction","Governance quality","Adaptability","Collaboration with others","Resource management","Sustainability of impact","Policy alignment","Public perception","Replication potential","Overall program effectiveness"
    ]}
  }}

  ,
  { domain: "Real Estate", types: {
    A: { name: "Property Purchase Decision", items: [
      "Location quality","Neighborhood safety","Price vs market","Structural condition",
      "Maintenance history","Legal title clarity","Zoning compliance","Construction quality",
      "Energy efficiency","Natural light & ventilation","Noise levels","Infrastructure & transport",
      "Nearby amenities","Future development outlook","Tax & fees impact",
      "Resale potential","Rental yield potential","Total cost of ownership",
      "Fit to requirements","Overall assessment"
    ]},
    B: { name: "Property Rental Decision", items: [
      "Location suitability","Safety of area","Rent vs market","Condition of property",
      "Maintenance responsiveness","Landlord reliability","Privacy level","Security features",
      "Contract clarity","Deposit fairness","Noise environment","Transport connections",
      "Amenities distance","Building age","Energy efficiency","Flexibility of contract",
      "Utility costs","Internet quality","Fit to needs","Overall assessment"
    ]}
  }},
  { domain: "Procurement", types: {
    A: { name: "Procurement Decision", items: [
      "Compliance with specifications","Product/service quality","Supplier reliability",
      "Delivery time capability","Technical support","Supplier reputation","Past performance",
      "Scalability","Warranty conditions","Contract clarity","Risk management","ESG responsibility",
      "Innovation potential","Financial stability","Communication responsiveness","Transparency",
      "Total cost of ownership","Price competitiveness","Compatibility","Overall value"
    ]},
    B: { name: "Supplier Performance Review", items: [
      "Quality consistency","Timeliness of delivery","Accuracy of orders","Responsiveness",
      "Support quality","Innovation contribution","Compliance adherence","Risk behavior",
      "Flexibility","Cost performance","Relationship quality","Process transparency",
      "Documentation quality","Capability growth","Sustainability alignment",
      "Contract fulfillment","Communication clarity","Escalation handling","Reliability","Overall performance"
    ]}
  }},
  { domain: "Skills", types: {
    A: { name: "Skills Assessment", items: [
      "Technical expertise","Problem-solving","Communication","Teamwork","Creativity",
      "Adaptability","Learning agility","Accuracy","Speed","Confidence",
      "Autonomy","Planning","Prioritization","Stakeholder management","Leadership",
      "Stress tolerance","Decision quality","Professionalism","Knowledge breadth","Overall skill rating"
    ]},
    B: { name: "Skill Development Needs", items: [
      "Gap criticality","Learning priority","Role relevance","Impact potential","Difficulty level",
      "Training urgency","Resource availability","Time feasibility","Mentor support","Practice opportunity",
      "Transferability","Retention likelihood","Motivation fit","Confidence growth","Peer learning potential",
      "Certification value","Progress measurability","Expected ROI","Career alignment","Overall priority"
    ]}
  }},
  { domain: "Performance", types: {
    A: { name: "Job Performance Review", items: [
      "Goal achievement","Work quality","Productivity","Initiative","Teamwork","Communication",
      "Leadership","Reliability","Customer feedback","Problem-solving","Adaptability",
      "Time management","Professional growth","Ethics","Innovation","Attendance",
      "Project success","KPI results","Peer feedback","Overall performance"
    ]},
    B: { name: "Sports Performance Evaluation", items: [
      "Physical condition","Strength","Agility","Speed","Endurance","Technique",
      "Tactical understanding","Consistency","Injury prevention","Discipline",
      "Team contribution","Focus","Motivation","Recovery","Execution quality",
      "Competition results","Training intensity","Coachability","Adaptability","Overall performance"
    ]}
  }}

]; // Grouping metadata
const GROUPS = {
  "Organizational Domains": [
    "People & Talent",
    "Organizational & Strategic",
    "Financial & Investment",
    "Innovation & Creativity",
    "Environment & Sustainability",
    "Community & Social Impact",
    "Procurement",
    "Performance"
  ],
  "Personal Domains": [
    "Health & Wellbeing",
    "Learning & Development",
    "Skills"
  ],
  "Market & Assets": [
    "Real Estate"
  ]
};

// ===== State & Persistence
const LS_KEY = "avail_v7_state";
function loadState(){ try { return JSON.parse(localStorage.getItem(LS_KEY) || "{}"); } catch { return {}; } }
function saveState(state){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
const state = loadState(); // { [domain__type]: { optionNames, questions, values } }
function scenarioKey(domain, type){ return `${domain}__${type}`; }

// ===== Utilities
function optionColor(i, alpha=0.15){ const hue = (i * 137) % 360; return { stroke: `hsl(${hue} 50% 45%)`, fill: `hsla(${hue} 60% 50% / ${alpha})` }; }
function deepClone(x){ return JSON.parse(JSON.stringify(x)); }
function findDomain(name){ return BASE_MODEL.find(d=>d.domain===name); }
function isPersonalDomain(name){ return GROUPS["Personal Domains"].includes(name); }

// ===== DOM
const select = document.getElementById("domainSelect");
const typeRadios = document.getElementById("typeRadios");
const optionNamesRoot = document.getElementById("optionNames");
const questionsRoot = document.getElementById("questions");
const addOptionBtn = document.getElementById("addOption");
const removeOptionBtn = document.getElementById("removeOption");
const addQuestionBtn = document.getElementById("addQuestion");
const removeQuestionBtn = document.getElementById("removeQuestion");
const btnPng = document.getElementById("btnPng");
const btnPdf = document.getElementById("btnPdf");
const categoryHint = document.getElementById("categoryHint");

// Build grouped dropdown
function buildDropdown(){
  select.innerHTML = `<option value="">– choose –</option>`;
  for(const [group, domains] of Object.entries(GROUPS)){
    const og = document.createElement("optgroup");
    og.label = group;
    domains.forEach(name => {
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = name;
      og.appendChild(opt);
    });
    select.appendChild(og);
  }
}
buildDropdown();

// ===== Charts (mobile + desktop)
function makeChart(id){
  const ctx = document.getElementById(id)?.getContext("2d");
  if(!ctx) return null;
  return new Chart(ctx, {
    type:"radar",
    data:{ labels:[], datasets:[] },
    options:{
      responsive:true, maintainAspectRatio:false,
      scales:{ r:{ beginAtZero:true, min:0, max:10, ticks:{ stepSize:2 }, grid:{ circular:true, color:"rgba(0,0,0,0.08)"}, angleLines:{color:"rgba(0,0,0,0.08)"}, pointLabels:{font:{size:12}} } },
      plugins:{ legend:{ position:"bottom" } },
      animation:{ duration:220, easing:"easeOutQuad" }
    }
  });
}
const chartMob = makeChart("radar-mobile");
const chartDesk = makeChart("radar-desktop");
const overlayMob = document.getElementById("overlay-mob");
const overlayDesk = document.getElementById("overlay-desk");

function updateCharts(labels, datasets){
  [chartMob, chartDesk].forEach(ch => {
    if(!ch) return;
    ch.data.labels = labels;
    ch.data.datasets = datasets;
    ch.update();
  });
}
function updateLegendLabels(optionNames){
  [chartMob, chartDesk].forEach(ch => {
    ch?.data?.datasets?.forEach((ds, i) => ds.label = optionNames[i] || ds.label);
    ch?.update();
  });
}

// ===== Current selection
let currentDomain = null;
let currentType = null;

// Scenario state helpers
function getScenarioState(){
  if(!currentDomain || !currentType) return null;
  const key = scenarioKey(currentDomain, currentType);
  if(!state[key]){
    const base = findDomain(currentDomain)?.types?.[currentType]?.items || [];
    state[key] = {
      optionNames: ["Option A","Option B","Option C"],
      questions: deepClone(base),
      values: Array.from({length: 3}, () => new Array(base.length).fill(5))
    };
    saveState(state);
  }
  return state[key];
}
function setScenarioState(partial){
  const key = scenarioKey(currentDomain, currentType);
  state[key] = Object.assign({}, getScenarioState(), partial);
  saveState(state);
}

// Render category hint line
function renderCategoryHint(){
  if(!currentDomain){
    categoryHint.textContent = "My avail is about …";
    categoryHint.style.opacity = 0.9;
    return;
  }
  const isPers = isPersonalDomain(currentDomain);
  categoryHint.textContent = isPers ? "My avail is about …" : "My avail is about …";
  categoryHint.style.opacity = 0.95;
  categoryHint.style.color = isPers ? "#9f7f88" : "#8a7a66"; // subtle rose/brown
}

// Render type radios
function renderTypeRadios(domainName){
  typeRadios.innerHTML = "";
  const dom = findDomain(domainName);
  if(!dom) return;
  const entries = [
    {key:"A", label: dom.types.A.name},
    {key:"B", label: dom.types.B.name}
  ];
  entries.forEach((t) => {
    const id = "type-" + t.key;
    const row = document.createElement("label");
    row.className = "flex items-center gap-2 cursor-pointer mb-2";
    row.innerHTML = `<input type="radio" name="scenarioType" id="${id}" value="${t.key}" class="accent-[#B06A77]"><span>${t.label}</span>`;
    typeRadios.appendChild(row);
  });
  typeRadios.querySelectorAll("input[type='radio']").forEach(r => {
    r.addEventListener("change", () => {
      currentType = r.value;
      renderScenario();
    });
  });
}

function renderOptionInputs(s){
  optionNamesRoot.innerHTML = "";
  s.optionNames.forEach((name, idx) => {
    const wrap = document.createElement("div");
    wrap.className = "flex items-center gap-2";
    const color = optionColor(idx, 0.25);
    wrap.innerHTML = `
      <div class="h-4 w-4 rounded-full" style="background:${color.stroke}"></div>
      <input type="text" class="border rounded-lg px-2 py-1 w-full" value="${name}" data-idx="${idx}" />
    `;
    optionNamesRoot.appendChild(wrap);
  });
  optionNamesRoot.querySelectorAll("input[type='text']").forEach(inp => {
    inp.addEventListener("input", () => {
      const i = +inp.dataset.idx;
      s.optionNames[i] = inp.value || `Option ${String.fromCharCode(65+i)}`;
      setScenarioState({ optionNames: s.optionNames });
      updateLegendLabels(s.optionNames);
    });
  });
}

function buildDatasets(s){
  return s.optionNames.map((name, i) => {
    const col = optionColor(i);
    return {
      label: name,
      data: s.values[i].slice(),
      borderColor: col.stroke,
      backgroundColor: col.fill,
      pointRadius: 3,
      pointHoverRadius: 5,
      tension: 0.2
    };
  });
}

function renderQuestions(s){
  questionsRoot.innerHTML = "";
  s.questions.forEach((criterion, qIdx) => {
    const card = document.createElement("div");
    card.className = "card criteria-card p-2";
    const labelDiv = document.createElement("div");
    labelDiv.className = "text-xl font-semibold headline mb-2 editable";
    labelDiv.contentEditable = "true";
    labelDiv.textContent = criterion;
    card.appendChild(labelDiv);

    const hint = document.createElement("p");
    hint.className = "italic text-slate-600 mb-4";
    hint.textContent = "Edit label above. Rate each option 0–10.";
    card.appendChild(hint);

    const grid = document.createElement("div");
    grid.className = "grid grid-cols-1 md:grid-cols-3 gap-1.5 text-sm";
    s.optionNames.forEach((name, oIdx) => {
      const col = optionColor(oIdx);
      const box = document.createElement("div");
      box.className = "p-3 rounded-xl border border-black/5 bg-white/70";
      box.innerHTML = `
        <label class="block text-sm text-slate-700 mb-1">${name}: <span id="val-${oIdx}-${qIdx}" class="font-semibold">${s.values[oIdx][qIdx]}</span></label>
        <input id="sl-${oIdx}-${qIdx}" type="range" min="0" max="10" value="${s.values[oIdx][qIdx]}" step="1" class="slider w-full" style="accent-color:${col.stroke}">
      `;
      grid.appendChild(box);
    });
    card.appendChild(grid);
    questionsRoot.appendChild(card);

    // Persist label edits
    labelDiv.addEventListener("input", () => {
      s.questions[qIdx] = labelDiv.textContent.trim() || `Criterion ${qIdx+1}`;
      setScenarioState({ questions: s.questions });
      updateCharts(s.questions, buildDatasets(s));
    });

    // Slider events
    s.optionNames.forEach((_, oIdx) => {
      const sl = card.querySelector(`#sl-${oIdx}-${qIdx}`);
      const val = card.querySelector(`#val-${oIdx}-${qIdx}`);
      sl.addEventListener("input", () => {
        s.values[oIdx][qIdx] = +sl.value;
        val.textContent = sl.value;
        setScenarioState({ values: s.values });
        [chartMob, chartDesk].forEach(ch => {
          ch.data.datasets[oIdx].data[qIdx] = +sl.value;
          ch.update();
        });
      });
    });
  });
}

function renderScenario(){
  renderCategoryHint();
  const s = getScenarioState();
  if(!s){
    updateCharts([], []);
    overlayMob.style.opacity = 1;
    overlayMob.style.transition = "opacity 0.5s ease";
    overlayMob.classList.remove("hidden");
    overlayDesk.style.opacity = 1;
    overlayDesk.style.transition = "opacity 0.5s ease";
    overlayDesk.classList.remove("hidden");
    return;
  }
  overlayMob.style.opacity = 0;
    setTimeout(() => overlayMob.classList.add("hidden"), 500);
  overlayDesk.style.opacity = 0;
    setTimeout(() => overlayDesk.classList.add("hidden"), 500);

  renderOptionInputs(s);
  renderQuestions(s);
  const datasets = buildDatasets(s);
  updateCharts(s.questions, datasets);
}

// ===== Buttons: add/remove options & questions
document.getElementById("addOption").addEventListener("click", () => {
  const s = getScenarioState(); if(!s) return;
  const newIdx = s.optionNames.length;
  s.optionNames.push(`Option ${String.fromCharCode(65+newIdx)}`);
  s.values.push(new Array(s.questions.length).fill(5));
  setScenarioState({ optionNames: s.optionNames, values: s.values });
  renderScenario();
});
document.getElementById("removeOption").addEventListener("click", () => {
  const s = getScenarioState(); if(!s) return;
  if(s.optionNames.length <= 1) return;
  s.optionNames.pop();
  s.values.pop();
  setScenarioState({ optionNames: s.optionNames, values: s.values });
  renderScenario();
});
document.getElementById("addQuestion").addEventListener("click", () => {
  const s = getScenarioState(); if(!s) return;
  const newLabel = `New criterion ${s.questions.length+1}`;
  s.questions.push(newLabel);
  s.values.forEach(row => row.push(5));
  setScenarioState({ questions: s.questions, values: s.values });
  renderScenario();
});
document.getElementById("removeQuestion").addEventListener("click", () => {
  const s = getScenarioState(); if(!s) return;
  if(s.questions.length <= 1) return;
  s.questions.pop();
  s.values.forEach(row => row.pop());
  setScenarioState({ questions: s.questions, values: s.values });
  renderScenario();
});

// ===== Export
function currentChart(){ return (window.innerWidth >= 1024) ? chartDesk : chartMob; }
document.getElementById("btnPng").addEventListener("click", () => {
  const ch = currentChart();
  const url = ch?.toBase64Image("image/png", 1.0);
  if(!url) return;
  const a = document.createElement("a");
  const date = new Date().toISOString().split("T")[0];
  const domTxt = currentDomain || "domain";
  const typeTxt = currentType || "type";
  a.href = url;
  a.download = `avail_${domTxt}_${typeTxt}_${date}.png`;
  a.click();
});
// Wire domain select
select.addEventListener("change", () => {
  currentDomain = select.value || null;
  currentType = null;
  renderTypeRadios(currentDomain);
  renderScenario();
});

// Kick off
renderScenario();


// === Hard override: branded red header ===
function exportPNGRed(){
  const ch = currentChart();
  if(!ch) return;
  const chartImg = ch.canvas.toDataURL("image/png");

  const headerH = 100;
  const w = ch.canvas.width;
  const h = ch.canvas.height + headerH;

  const cnv = document.createElement("canvas");
  cnv.width = w;
  cnv.height = h;
  const ctx = cnv.getContext("2d");

  ctx.fillStyle = "#de0707";
  ctx.fillRect(0,0,w,headerH);

  ctx.fillStyle = "white";
  ctx.font = "bold 40px Space Grotesk, sans-serif";
  ctx.fillText("avail.center", 30, 60);

  const img = new Image();
  img.onload = () => {
    ctx.drawImage(img,0,headerH);
    const url = cnv.toDataURL("image/png");
    const a = document.createElement("a");
    const d = new Date().toISOString().split("T")[0];
    a.href = url;
    a.download = `avail_${currentDomain||"domain"}_${currentType||"type"}_${d}.png`;
    a.click();
  };
  img.src = chartImg;
}

function exportPDFRed(){
  if(!currentDomain || !currentType) return;
  const s = getScenarioState();
  const d = new Date().toISOString().split("T")[0];
  const ch = currentChart();
  const chartImg = ch.canvas.toDataURL("image/png");
  const { jsPDF } = window.jspdf;

  const pdf = new jsPDF({unit:"pt", format:"a4"});
  const pageWidth = pdf.internal.pageSize.getWidth();

  pdf.setFillColor(222,7,7);
  pdf.rect(0,0,pageWidth,70,"F");

  pdf.setTextColor(255,255,255);
  pdf.setFontSize(28);
  pdf.text("avail.center", 30, 45);

  let y = 90;
  pdf.setTextColor(0,0,0);
  pdf.setFont("helvetica","bold");
  pdf.setFontSize(14);
  pdf.text(`Domain: ${currentDomain}`, 40, y);
  y+=18;
  pdf.text(`Type: ${ findDomain(currentDomain).types[currentType].name }`, 40, y);
  y+=18;
  pdf.setFontSize(10);
  pdf.text(`Date: ${d}`, 40, y);
  y+=20;

  const imgSize = Math.min(pageWidth-80, 380);
  const cx = (pageWidth-imgSize)/2;
  pdf.addImage(chartImg,"PNG",cx,y,imgSize,imgSize);
  y+=imgSize+20;

  const headers = ["Criterion", ...s.optionNames];
  const rows = s.questions.map((q,i)=>[q, ...s.values.map(col=>col[i])]);

  let x=40; const colW=(pageWidth-80)/headers.length;
  pdf.setFont("helvetica","bold");
  pdf.setFontSize(9);
  headers.forEach(h=>{ pdf.text(String(h),x,y); x+=colW; });
  y+=12;

  pdf.setFont("helvetica","normal");
  rows.forEach(row=>{
    x=40;
    row.forEach(cell=>{
      const split = pdf.splitTextToSize(String(cell), colW-6);
      pdf.text(split,x,y,{maxWidth:colW-6});
      x+=colW;
    });
    y+=12;
    if(y > pdf.internal.pageSize.getHeight()-40){
      pdf.addPage();
      y=40;
    }
  });

  pdf.save(`avail_${currentDomain}_${currentType}_${d}.pdf`);
}


// === Paywall: plastico code ===
function validatePlastico(code) {
  if (!/^\d{8}$/.test(code)) return false;
  const digits = code.split("").map(Number);
  const sum = digits.slice(0, 7).reduce((a, b) => a + b, 0);
  const checksum = sum % 10;
  return digits[7] === checksum;
}

const paywallModal = document.getElementById("paywallModal");
const plasticoInput = document.getElementById("plasticoInput");
const plasticoError = document.getElementById("plasticoError");
const plasticoCancel = document.getElementById("plasticoCancel");
const plasticoVerify = document.getElementById("plasticoVerify");

function openPaywall() {
  // Force paywall always; no fallback export here.
  if (!paywallModal) {
    return;
  }
  plasticoInput.value = "";
  plasticoError.classList.add("hidden");
  paywallModal.classList.remove("hidden");
  paywallModal.classList.add("flex");
}

function closePaywall() {
  if (!paywallModal) return;
  paywallModal.classList.add("hidden");
  paywallModal.classList.remove("flex");
}

if (plasticoCancel) {
  plasticoCancel.addEventListener("click", () => {
    closePaywall();
  });
}

if (plasticoVerify) {
  plasticoVerify.addEventListener("click", () => {
    const code = plasticoInput.value.trim();
    if (!validatePlastico(code)) {
      plasticoError.classList.remove("hidden");
      return;
    }
    closePaywall();
    exportPDFRed(); // one-time export per successful code, no timer, no unlock memory
  });
}

// Wire exports with paywall for PDF
btnPng.onclick = exportPNGRed;
btnPdf.onclick = () => {
  openPaywall();
};

// === RESET BUTTON ===
const resetBtn = document.getElementById("resetBtn");
if (resetBtn) {
  resetBtn.addEventListener("click", () => {
    localStorage.clear();
    location.reload();
  });
}

// === Align reset button to same height as export buttons ===
function alignResetToExport(){
  const reset = document.getElementById("resetBtn");
  const pdf = document.getElementById("btnPdf");
  if(reset && pdf){
     const r = pdf.getBoundingClientRect();
     reset.style.top = r.top + "px";
  }
}
window.addEventListener("load", alignResetToExport);
window.addEventListener("resize", alignResetToExport);

// Reset logic
document.addEventListener("DOMContentLoaded", () => {
  const r=document.getElementById("resetBtn");
  if(r){ r.onclick=()=>{ localStorage.clear(); location.reload(); }; }
});

// Auto clear
localStorage.clear();



const paypalBtn = document.getElementById("paypalBtn");
if (paypalBtn) {
  paypalBtn.addEventListener("click", () => {
    alert("PayPal payment coming soon.");
  });
}



const stripeBtn = document.getElementById("stripeBtn");
if (stripeBtn) {
  stripeBtn.addEventListener("click", () => {
    alert("Stripe payment coming soon.");
  });
}


// Override behavior for Company License file
document.addEventListener("DOMContentLoaded", () => {
  if (!window.COMPANY_LICENSE_VALID) {
    const main = document.querySelector("main.left-col") || document.body;
    main.innerHTML = `
      <div class="card p-6 text-center" style="max-width:540px;margin:80px auto;">
        <h2 class="headline text-2xl mb-3">Company License invalid or expired</h2>
        <p class="text-sm opacity-80">
          This Company Annual License file is no longer valid.<br>
          Please request a new license from avail.center.
        </p>
      </div>
    `;
    return;
  }

  const pdfBtn = document.getElementById("btnPdf");
  const pngBtn = document.getElementById("btnPng");

  if (pngBtn && typeof exportPNGRed === "function") {
    pngBtn.onclick = exportPNGRed;
  }
  if (pdfBtn && typeof exportPDFRed === "function") {
    pdfBtn.onclick = () => {
      exportPDFRed();
    };
  }
});

</script>
  <script>
    // Hook header export buttons to existing handlers
    document.addEventListener('DOMContentLoaded', () => {
      const pngTop = document.getElementById('btnPngTop');
      const pdfTop = document.getElementById('btnPdfTop');
      const png = document.getElementById('btnPng');
      const pdf = document.getElementById('btnPdf');
      if (pngTop && png) pngTop.addEventListener('click', () => png.click());
      if (pdfTop && pdf) pdfTop.addEventListener('click', () => pdf.click());
    });
  </script>


<button id="resetBtn" class="btn" style="
position:fixed;
right:20px;
z-index:99999;
background:#b00000;
color:white;
padding:10px 16px;
border-radius:10px;
">Reset</button>
</body>
</html>
